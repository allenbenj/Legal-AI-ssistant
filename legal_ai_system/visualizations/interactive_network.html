<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Legal AI System - Dependency Network</title>
    <script src="https://unpkg.com/cytoscape@3.26.0/dist/cytoscape.min.js"></script>
    <script src="https://unpkg.com/cytoscape-cose-bilkent@4.1.0/cytoscape-cose-bilkent.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .controls button {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            background: #007bff;
            color: white;
        }
        
        .controls button:hover {
            background: #0056b3;
        }
        
        .controls button.active {
            background: #28a745;
        }
        
        #cy {
            width: 100%;
            height: 800px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .legend {
            margin-top: 20px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .legend-item {
            display: inline-block;
            margin: 5px 15px 5px 0;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            color: white;
        }
        
        .info-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 300px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            display: none;
            z-index: 1000;
        }
        
        .info-panel h3 {
            margin-top: 0;
            color: #333;
        }
        
        .info-panel .close {
            float: right;
            cursor: pointer;
            font-size: 18px;
            color: #999;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #007bff;
        }
        
        .stat-label {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Legal AI System - Dependency Network</h1>
            <p>Interactive visualization of Python file dependencies and function calls</p>
        </div>
        
        <div class="stats">
            <div class="stat-card">
                <div class="stat-number">66</div>
                <div class="stat-label">Total Files</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">450+</div>
                <div class="stat-label">Dependencies</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">15</div>
                <div class="stat-label">Core Files</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">12</div>
                <div class="stat-label">AI Agents</div>
            </div>
        </div>
        
        <div class="controls">
            <button id="layout-cose" class="active">CoSE Layout</button>
            <button id="layout-circle">Circle Layout</button>
            <button id="layout-grid">Grid Layout</button>
            <button id="filter-core">Show Core Only</button>
            <button id="filter-agents">Show Agents Only</button>
            <button id="filter-all">Show All</button>
            <button id="reset-zoom">Reset Zoom</button>
            <button id="export-png">Export PNG</button>
        </div>
        
        <div id="cy"></div>
        
        <div class="legend">
            <strong>Node Types:</strong>
            <span class="legend-item" style="background: #e74c3c;">Core System</span>
            <span class="legend-item" style="background: #3498db;">AI Agents</span>
            <span class="legend-item" style="background: #2ecc71;">Workflows</span>
            <span class="legend-item" style="background: #f39c12;">API Layer</span>
            <span class="legend-item" style="background: #9b59b6;">Frontend</span>
        </div>
        
        <div class="info-panel" id="info-panel">
            <span class="close" onclick="closeInfoPanel()">&times;</span>
            <h3 id="info-title">Node Information</h3>
            <div id="info-content"></div>
        </div>
    </div>

    <script>
        // Load the dependency data
        const dependencyData = {
            "nodes": [
                {
                    "data": {
                        "id": "unified_services",
                        "label": "unified_services.py",
                        "type": "core",
                        "importance": "critical",
                        "connections": 40,
                        "description": "Central service container with dependency injection"
                    }
                },
                {
                    "data": {
                        "id": "detailed_logging",
                        "label": "detailed_logging.py", 
                        "type": "core",
                        "importance": "critical",
                        "connections": 66,
                        "description": "Foundational logging infrastructure"
                    }
                },
                {
                    "data": {
                        "id": "base_agent",
                        "label": "base_agent.py",
                        "type": "agent",
                        "importance": "high",
                        "connections": 15,
                        "description": "Base class for all AI agents"
                    }
                },
                {
                    "data": {
                        "id": "llm_providers",
                        "label": "llm_providers.py",
                        "type": "core",
                        "importance": "high",
                        "connections": 25,
                        "description": "Multi-LLM provider management"
                    }
                },
                {
                    "data": {
                        "id": "api_main",
                        "label": "api/main.py",
                        "type": "api",
                        "importance": "high",
                        "connections": 12,
                        "description": "FastAPI backend server"
                    }
                },
                {
                    "data": {
                        "id": "document_processor",
                        "label": "document_processor.py",
                        "type": "agent",
                        "importance": "high",
                        "connections": 8,
                        "description": "Document processing agent"
                    }
                },
                {
                    "data": {
                        "id": "knowledge_graph_enhanced",
                        "label": "knowledge_graph_enhanced.py",
                        "type": "core",
                        "importance": "high",
                        "connections": 15,
                        "description": "Enhanced knowledge graph with Neo4j"
                    }
                },
                {
                    "data": {
                        "id": "vector_store_enhanced",
                        "label": "vector_store_enhanced.py",
                        "type": "core",
                        "importance": "high",
                        "connections": 12,
                        "description": "Enhanced vector storage with FAISS/LanceDB"
                    }
                },
                {
                    "data": {
                        "id": "ultimate_orchestrator",
                        "label": "ultimate_orchestrator.py",
                        "type": "workflow",
                        "importance": "high",
                        "connections": 12,
                        "description": "Master workflow orchestrator"
                    }
                },
                {
                    "data": {
                        "id": "realtime_analysis",
                        "label": "realtime_analysis_workflow.py",
                        "type": "workflow",
                        "importance": "high",
                        "connections": 10,
                        "description": "Real-time analysis workflow"
                    }
                },
                {
                    "data": {
                        "id": "frontend_gui",
                        "label": "enhanced-legal-ai-gui2.tsx",
                        "type": "frontend",
                        "importance": "high",
                        "connections": 3,
                        "description": "React frontend interface"
                    }
                }
            ],
            "edges": [
                {
                    "data": {
                        "source": "detailed_logging",
                        "target": "unified_services",
                        "type": "imports",
                        "weight": 5,
                        "relationship": "provides logging to"
                    }
                },
                {
                    "data": {
                        "source": "unified_services",
                        "target": "base_agent",
                        "type": "dependency_injection",
                        "weight": 4,
                        "relationship": "injects services into"
                    }
                },
                {
                    "data": {
                        "source": "base_agent",
                        "target": "document_processor",
                        "type": "inheritance",
                        "weight": 3,
                        "relationship": "parent class of"
                    }
                },
                {
                    "data": {
                        "source": "unified_services",
                        "target": "llm_providers",
                        "type": "manages",
                        "weight": 4,
                        "relationship": "manages instances of"
                    }
                },
                {
                    "data": {
                        "source": "unified_services",
                        "target": "knowledge_graph_enhanced",
                        "type": "manages",
                        "weight": 4,
                        "relationship": "manages instances of"
                    }
                },
                {
                    "data": {
                        "source": "unified_services",
                        "target": "vector_store_enhanced",
                        "type": "manages",
                        "weight": 4,
                        "relationship": "manages instances of"
                    }
                },
                {
                    "data": {
                        "source": "unified_services",
                        "target": "api_main",
                        "type": "provides_services",
                        "weight": 5,
                        "relationship": "provides services to"
                    }
                },
                {
                    "data": {
                        "source": "ultimate_orchestrator",
                        "target": "realtime_analysis",
                        "type": "orchestrates",
                        "weight": 4,
                        "relationship": "orchestrates workflow"
                    }
                },
                {
                    "data": {
                        "source": "realtime_analysis",
                        "target": "document_processor",
                        "type": "uses",
                        "weight": 3,
                        "relationship": "uses for processing"
                    }
                },
                {
                    "data": {
                        "source": "frontend_gui",
                        "target": "api_main",
                        "type": "http_requests",
                        "weight": 5,
                        "relationship": "makes API calls to"
                    }
                }
            ]
        };

        // Initialize Cytoscape
        const cy = cytoscape({
            container: document.getElementById('cy'),
            
            elements: dependencyData,
            
            style: [
                {
                    selector: 'node',
                    style: {
                        'background-color': function(ele) {
                            const type = ele.data('type');
                            switch(type) {
                                case 'core': return '#e74c3c';
                                case 'agent': return '#3498db';
                                case 'workflow': return '#2ecc71';
                                case 'api': return '#f39c12';
                                case 'frontend': return '#9b59b6';
                                default: return '#95a5a6';
                            }
                        },
                        'label': 'data(label)',
                        'color': '#fff',
                        'text-wrap': 'wrap',
                        'text-max-width': '100px',
                        'font-size': '10px',
                        'text-valign': 'center',
                        'text-halign': 'center',
                        'width': function(ele) {
                            return Math.max(30, Math.min(80, ele.data('connections') * 2));
                        },
                        'height': function(ele) {
                            return Math.max(30, Math.min(80, ele.data('connections') * 2));
                        },
                        'border-width': function(ele) {
                            return ele.data('importance') === 'critical' ? 4 : 2;
                        },
                        'border-color': '#2c3e50'
                    }
                },
                {
                    selector: 'edge',
                    style: {
                        'width': function(ele) {
                            return ele.data('weight');
                        },
                        'line-color': function(ele) {
                            const type = ele.data('type');
                            switch(type) {
                                case 'inheritance': return '#e67e22';
                                case 'imports': return '#3498db';
                                case 'manages': return '#2ecc71';
                                case 'uses': return '#9b59b6';
                                case 'orchestrates': return '#e74c3c';
                                default: return '#95a5a6';
                            }
                        },
                        'target-arrow-color': function(ele) {
                            return ele.style('line-color');
                        },
                        'target-arrow-shape': 'triangle',
                        'curve-style': 'bezier',
                        'opacity': 0.7
                    }
                },
                {
                    selector: 'node:selected',
                    style: {
                        'border-width': 6,
                        'border-color': '#f1c40f'
                    }
                },
                {
                    selector: 'edge:selected',
                    style: {
                        'width': function(ele) {
                            return ele.data('weight') + 2;
                        },
                        'opacity': 1
                    }
                }
            ],
            
            layout: {
                name: 'cose-bilkent',
                animate: true,
                animationDuration: 1000,
                randomize: false,
                nodeRepulsion: 4500,
                idealEdgeLength: 50,
                edgeElasticity: 0.45,
                nestingFactor: 0.1,
                gravity: 0.25,
                numIter: 2500,
                tile: true,
                packComponents: true
            }
        });

        // Event handlers
        cy.on('tap', 'node', function(evt) {
            const node = evt.target;
            showInfoPanel(node.data());
        });

        // Control buttons
        document.getElementById('layout-cose').addEventListener('click', function() {
            setActiveButton(this);
            cy.layout({
                name: 'cose-bilkent',
                animate: true,
                animationDuration: 1000
            }).run();
        });

        document.getElementById('layout-circle').addEventListener('click', function() {
            setActiveButton(this);
            cy.layout({
                name: 'circle',
                animate: true,
                animationDuration: 1000
            }).run();
        });

        document.getElementById('layout-grid').addEventListener('click', function() {
            setActiveButton(this);
            cy.layout({
                name: 'grid',
                animate: true,
                animationDuration: 1000
            }).run();
        });

        document.getElementById('filter-core').addEventListener('click', function() {
            filterNodes('core');
        });

        document.getElementById('filter-agents').addEventListener('click', function() {
            filterNodes('agent');
        });

        document.getElementById('filter-all').addEventListener('click', function() {
            cy.elements().show();
        });

        document.getElementById('reset-zoom').addEventListener('click', function() {
            cy.fit();
        });

        document.getElementById('export-png').addEventListener('click', function() {
            const png = cy.png({
                output: 'blob',
                scale: 2,
                full: true
            });
            
            const link = document.createElement('a');
            link.download = 'legal-ai-dependency-network.png';
            link.href = URL.createObjectURL(png);
            link.click();
        });

        function setActiveButton(button) {
            document.querySelectorAll('.controls button').forEach(btn => 
                btn.classList.remove('active')
            );
            button.classList.add('active');
        }

        function filterNodes(type) {
            cy.elements().hide();
            cy.nodes(`[type="${type}"]`).show();
            cy.edges().forEach(edge => {
                const source = edge.source();
                const target = edge.target();
                if (source.visible() && target.visible()) {
                    edge.show();
                }
            });
        }

        function showInfoPanel(nodeData) {
            const panel = document.getElementById('info-panel');
            const title = document.getElementById('info-title');
            const content = document.getElementById('info-content');
            
            title.textContent = nodeData.label;
            content.innerHTML = `
                <p><strong>Type:</strong> ${nodeData.type}</p>
                <p><strong>Importance:</strong> ${nodeData.importance}</p>
                <p><strong>Connections:</strong> ${nodeData.connections}</p>
                <p><strong>Description:</strong> ${nodeData.description}</p>
            `;
            
            panel.style.display = 'block';
        }

        function closeInfoPanel() {
            document.getElementById('info-panel').style.display = 'none';
        }

        // Initialize with fit view
        cy.ready(function() {
            cy.fit();
        });
    </script>
</body>
</html>